---
title: expo(React Native)ã«ãŠã‘ã‚‹ç§çš„ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ãƒ«ãƒ¼ãƒ«æ¤œè¨ï¼ˆã‚ã‚‹ã„ã¯å¦‚ä½•ã«ã—ã¦OTAã¨ä»˜ãåˆã†ã‹ï¼‰
emoji: 'ğŸ¥‘'
type: idea
topics:
  - reactnative
  - expo
  - javascript
  - versioning
published: true
terrier_export_from: https://note.com/terrierscript/n/n3baa3404d76b
---

:::message
ã“ã®è¨˜äº‹ã¯2020/08/27ã«noteã«æŠ•ç¨¿ã—ãŸè¨˜äº‹ã‚’ç§»æ¤ã—ãŸã‚‚ã®ã§ã™
:::

expoã‚’ä½¿ã„å§‹ã‚ã¦ã€React Nativeã§ä½•åº¦ã‹æŒ«æŠ˜ã—ã¦ã„ãŸè‡ªåˆ†ã«ã¨ã£ã¦åŸºæœ¬çš„ã«æœ¬å½“ã«æœ€é«˜ã§æœ€é«˜ãªã®ã ã‘ã©ã€ã©ã†ã—ã¦ã‚‚releaseChannelã¨ã‹ãƒªãƒªãƒ¼ã‚¹ç®¡ç†å‘¨ã‚Šã ã‘ã¡ã‚‡ã£ã¨å›°ã‚Šã©ã“ã‚ãŒã‚ã£ãŸã®ã§ã©ã†ç®¡ç†ã™ã‚‹ã¨è‰¯ã„ã‹ã«ã¤ã„ã¦è€ƒãˆã¦ã¿ãŸã€‚

## å›°ã‚Šã”ã¨

expoã«ãŠã„ã¦æœ¬ç•ªãƒ“ãƒ«ãƒ‰ã‚’ã™ã‚‹å ´åˆã€ãƒ“ãƒ«ãƒ‰ã¨åŒã˜ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§publishã•ã‚Œã¦ã—ã¾ã†ã€‚expoã¯OTAã®ä»•çµ„ã¿ãŒã‚ã‚‹ãŸã‚ã€æ›´æ–°ãŒã‹ã‹ã£ã¦ã—ã¾ã†ã€‚

ã¤ã¾ã‚ŠåŒã˜releaseChannelã«ã—ã¦ã—ã¾ã†ã¨ã‚¹ãƒˆã‚¢ã«å¯©æŸ»ç”¨ã®ãƒ“ãƒ«ãƒ‰ã‚’ã™ã‚‹ã¨ãã®æ™‚ç‚¹ã§OTAãŒã‹ã‹ã£ã¦ã—ã¾ã„ã†ã‚‹

[è¨­å®šã«ã‚ˆã£ã¦OTAã‚’disableã«ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½](https://docs.expo.io/versions/latest/config/app/)ã ãŒã€ã„ã–ã¨ã„ã†ã¨ãã«ã¯ä¾¿åˆ©ãªã®ã§å®Œå…¨ã«ã‚ªãƒ•ã«ã—ã¦ã—ã¾ã†ã®ã‚‚ã‚‚ã£ãŸã„ãªã„ã€‚

ãã‚Œã»ã©ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒªã«æ˜ã‚‹ã„ã‚ã‘ã§ã¯ãªã„ã®ã§æ‰‹æ¢ã‚Šã§ã¯ã‚ã‚‹ã‚‚ã®ã®ã€ã¨ã‚Šã‚ãˆãšè‡ªåˆ†ãªã‚Šã«ã€Œã“ã†ã„ã†ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã«ã—ãŸã‚‰ã„ã„ã¨ã“å–ã‚ŠãŒå‡ºæ¥ã‚‹ã‚“ã§ã¯ãªã„ã‹ï¼Ÿã€ã‚’è€ƒãˆã¦ã¿ãŸã€‚ã‚‚ã£ã¨è‰¯ã„ã®ãŒã‚ã£ãŸã‚‰æ•™ãˆã¦ã»ã—ã„

## ã‚ªãƒ¬ã‚ªãƒ¬expoãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ãƒ«ãƒ¼ãƒ«

ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ã®ã‚¢ãƒ—ãƒªã§ã‚ã‚Œã°ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¨ã¯é•ã„ã€ãã‚Œã»ã©å³å¯†ã«ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã«å¯„ã›ã‚‹æ„å‘³ã‚‚ç„¡ã„ã®ã ãŒã€ã›ã£ã‹ãé¦´æŸ“ã¿ã®ã‚ã‚‹ãƒ«ãƒ¼ãƒ«ãªã®ã§ã“ã‚Œã‚’ä¸€éƒ¨ã‚’ãƒ™ãƒ¼ã‚¹ã«ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã™ã‚‹å½¢ã‚’è€ƒãˆã¦ã¿ãŸã€‚

x.y.zã®ã‚ˆã†ãªå½¢å¼ã«ãªãã‚‰ãˆã‚‹ã¨ä¸‹è¨˜ã®ã‚ˆã†ã«ãªã‚‹ã€‚

- x(major) - ç ´å£Šçš„å¤‰æ›´ã€‚APIç­‰äº’æ›æ€§ãŒãªããªã‚‹å ´åˆãªã©ã€‚
- y(minor) - ã‚¹ãƒˆã‚¢ãƒªãƒªãƒ¼ã‚¹ã®ãŸã³ã«æ›´æ–°ã™ã‚‹ã€‚æ—¥ä»˜ãªã©ã§ã‚‚è‰¯ã„ã‹ã‚‚ï¼Ÿ
- z(patch) - ã‚¹ãƒˆã‚¢ãƒªãƒªãƒ¼ã‚¹ã‚’ä¼´ã‚ãªã„ãƒ“ãƒ«ãƒ‰æ›´æ–°ã€‚å¯©æŸ»ç”¨å†ãƒ“ãƒ«ãƒ‰ã‚„OTAã§ã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ

majorãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯ã»ã¨ã‚“ã©ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã¨åŒã˜ã§ã€ä½•ã‚‰ã‹ã®ç ´å£Šçš„å¤‰æ›´ã‚’ä¼´ã†å ´åˆã«åˆ©ç”¨ã™ã‚‹ã€‚ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã¯ãªã„ã®ã§ãã†å¤šãã¯ãªã„ãŒã€ä¾‹ãˆã°ã‚µãƒ¼ãƒãƒ¼ã®APIãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«äº’æ›æ€§ãŒç„¡ã„å ´åˆãªã©ã ã‚ã†ã€‚

minorãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¨å¤§ããå¤‰ãˆã¦ã„ã‚‹ã€‚ã©ã†ã—ã¦ã‚‚ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒªã®å ´åˆã€ã‚¹ãƒˆã‚¢ãƒªãƒªãƒ¼ã‚¹ã¨ã„ã†å¤§ããªå‘¨æœŸãŒã‚ã‚‹ã®ã§ã€ã“ã‚Œã¯å¤–ã—ãŸããªã„ã€‚ãªã®ã§minorãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’åˆ©ç”¨ã—ã¦ã¿ã‚‹ã“ã¨ã«ã—ãŸã€‚ã‚‚ã—æ¯é€±ãƒªãƒªãƒ¼ã‚¹ãªã©ã‚’ã—ã¦ã„ã‚‹ã®ã§ã‚ã‚Œã°ã€æ—¥ä»˜ãªã©ã«ã—ã¦ã‚‚è‰¯ã„ã‹ã‚‚ã—ã‚Œãªã„ã€‚

patchãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯OTAã«åˆ©ç”¨ã™ã‚‹ãŸã‚ã«é–‹ã‘ã¦ãŠãã€‚å†å¯©æŸ»ã‚„å¯©æŸ»å‰ã®ãƒ“ãƒ«ãƒ‰æ™‚ã«æ›´æ–°ã™ã‚‹ã“ã¨ã‚‚ã‚ã‚‹ã ã‚ã†ã€‚

ã“ã‚Œã«ç¿’ã†ã¨ãŠãã‚‰ãmajorãŒæœ€ã‚‚åˆ©ç”¨ã•ã‚Œã‚‹ã®ã§ã€1.234.2ãªã©ã«ãªã£ã¦ã„ãã ã‚ã†ã€‚minorã‚’æ—¥ä»˜ã«ã™ã‚‹ãªã‚‰1.20200901.1ãªã©ã ã‚ã†ã€‚

## Release Channelã®é‹ç”¨

æ¬¡ã¯ã“ã®ãƒ«ãƒ¼ãƒ«ã«åˆã‚ã›ã¦patchæ›´æ–°ã®publishã ã‘OTAãŒé©å¿œã•ã‚Œã‚‹release-channelé‹ç”¨ã‚’è¨­å®šã—ã¦ã¿ã‚‹ã€‚

è‡ªå‰ã§ã‚‚è‰¯ã‹ã£ãŸãŒ[semver-extract](https://www.npmjs.com/package/semver-extract)ã¨ã„ã†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒã‚½ãƒ¼ã‚¹ã‚‚å°ã•ãã¡ã‚‡ã†ã©è‰¯ã‹ã£ãŸã®ã§ã“ã‚Œã‚’ä½¿ã£ã¦ã¿ã‚‹ã€‚ä¸‹è¨˜ã®ã‚ˆã†ãªå…·åˆã§ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’echoã—ã¦ãã‚Œã‚‹

```jsx
$ semver-extract --pjson --minor -x
1.2.x
```

ã“ã‚Œã‚’package.jsonã«ä»•è¾¼ã‚€

```jsx

"scripts": {
	"release-channel": "echo v$(semver-extract --pjson --minor -x)",
	"build:ios": "expo build:ios --release-channel=production-$(npm run release-channel --silent)"
}
```

ã“ã®Release Channelã®ãƒ«ãƒ¼ãƒ«ã§é€²ã‚ã‚Œã°ã€ produciton-v1.2 ãªã©ã§æ›´æ–°ã•ã‚Œã‚‹ã®ã§ã€ 1.2.3 â†’ 1.3.0 ã®ã‚ˆã†ãªã‚¹ãƒˆã‚¢ãƒªãƒªãƒ¼ã‚¹ã‚’ã¾ãŸããŸã„ã‚ˆã†ãªå ´åˆã¯OTAã«ã‚ˆã‚‹æ›´æ–°ã¯èµ·ããªã„ã€‚ä¸€æ–¹ã§ 1.2.3 ã«å•é¡ŒãŒã‚ã£ãŸå ´åˆã¯ 1.2.4 ã«ã™ã‚‹ã€ã®ã‚ˆã†ãªå ´åˆã¯OTAã‚’åˆ©ç”¨ã‚‚ã§ãã‚‹ã€‚

# ãŠã¾ã‘: ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«çµ¡ã‚€tips

## ãŠã¾ã‘1: Productionã¨Stagingã¯ã©ã†ã™ã‚‹ï¼Ÿ

ã“ã‚Œã¯ã‚‚ã†slugã‚„bundleIdentifierã”ã¨åˆ†ã‘ã¦ã—ã¾ã£ãŸã»ã†ãŒæ¥½ã‹ãªã¨æ€ã£ãŸã€‚

stagingç”¨ã«overrideã—ãŸã„éƒ¨åˆ†ã‚’jsonã«è¨˜è¼‰ã—ã¦ãŠãã€app.config.jsã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ã¦ä¸Šæ›¸ãã™ã‚‹ã‚ˆã†ã«ã—ã¦ã¿ã‚‹

```jsx
// app-staging.json
{
  "name": "My App [Staging]",
  "displayName": "My App [Staging]",
  "expo": {
    "name": "My App [Staging]",
    "description": "My App [Staging]",
    "slug": "staging-my-app",
    "ios": {
      "bundleIdentifier": "my.app.staging",
    }
  }
}
```

```jsx
// app.config.js
import merge from "deepmerge"
import stagingConfig from "./app-staging.json"

const overrideEnv = (baseConfig) => {
  if (process.env.BUILD_ENV === "staging") {
    return merge.all([baseConfig, stagingConfig])
  }
  return baseConfig
}
export default ({ config }) => {
  const conf = overrideEnv(config)
  return conf
}
```

app.config.jsã§releaseChannelã‚’å–å¾—ã§ãã‚Œã°è‰¯ã„ã®ã ãŒã€æ®‹å¿µãªãŒã‚‰å‡ºæ¥ãªã„ã‚ˆã†ãªã®ã§ package.jsonã§ BUILD_ENV ã‚’æ¸¡ã—ã¦ãŠã“ã†

```jsx
// package.json
"scripts": {
  "build:ios:staging": "BUILD_ENV=staging expo build:ios --release-channel=staging-$(npm run release-channel --silent)"
}
```

## ãŠã¾ã‘2: react-native-versionã‚’postversionã«ä»•æ›ã‘ã¦ãŠãã¨ä¾¿åˆ©

æ™®é€šã«ã‚„ã£ã¦ã„ã‚‹ã¨ app.json ã®buildNumberã¨versionCodeã‚’æ‰‹å‹•æ›´æ–°ã—ãªãã‚ƒã„ã‘ãªãã¦ã‚ã‚“ã©ãã•ã„ãªã¨æ€ã£ã¦ã„ãŸã®ã ãŒ[react-native-version](https://github.com/stovmascript/react-native-version)ã‚’ä½¿ã†ã¨ã»ã¨ã‚“ã©æ„è­˜ã—ãªãã¦è‰¯ããªã£ãŸ

[https://github.com/stovmascript/react-native-version](https://github.com/stovmascript/react-native-version)

```jsx
"scripts": {
	"postversion": "react-native-version"
}
```

ã“ã‚Œã§ yarn version ã‚„ npm version ã‚’ã™ã‚‹ã¨ãã®å¾Œæ›´æ–°ã•ã‚Œã‚‹ã€‚ä¾¿åˆ©

## ã¾ã¨ã‚

åŸºæœ¬çš„ã«ã“ã‚Œã¯expoã‚’å‰æã«è€ƒãˆã¦ã¿ãŸãƒãƒ¼ã‚¸ãƒ§ãƒ³ã ãŒã€OTAãŒã‚ã‚‹ã‚ˆã†ãªå ´åˆãªã‚‰ãã“ãã“ä½¿ãˆã‚‹ã‹ã‚‚ã—ã‚Œãªã„ã€‚

expoã¯æœ€é«˜ã€‚